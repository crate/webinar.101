-- Manhattan complaints

select count(*), complaint_type from nyc."311" where within(geometry, 'POLYGON((-73.912528 40.796118, -73.921903 40.801776, -73.92766300000001 40.8024, -73.932364 40.80852, -73.933247 40.835632, -73.929128 40.844264, -73.920076 40.85659, -73.913396 40.863342, -73.906769 40.87598100000001, -73.911584 40.87913999999999, -73.915578 40.875696, -73.919855 40.87647, -73.933923 40.882019, -73.952891 40.851198, -73.963639 40.826673, -74.013934 40.757798, -74.023584 40.718157000000005, -74.026382 40.70013500000001, -74.035433 40.685121, -74.019577 40.679654, -74.004043 40.68879, -73.996531 40.701445, -73.9934 40.704633, -73.980909 40.705713, -73.969853 40.709427, -73.967286 40.716938, -73.961722 40.72487, -73.962547 40.736437, -73.96197500000001 40.741297, -73.957017 40.748819, -73.951051 40.754939, -73.941379 40.76709, -73.935903 40.77000099999999, -73.937838 40.774833, -73.934558 40.778251000000004, -73.930038 40.776399, -73.922345 40.780811, -73.90975 40.790954, -73.912528 40.796118))') group by 2 order by 1 desc limit 100;

-- Hell's Kitchen complaints

select count(*), complaint_type from nyc."311" where within(geometry, 'POLYGON((-73.99635314941406 40.77338537779408,-73.9932632446289 40.7728003801569,-73.98472309112549 40.769225282678875,-73.98523807525635 40.76854274220276,-73.9822769165039 40.76730765113972,-73.99352073669434 40.75215966764842,-74.0050220489502 40.75713352783554,-74.00249004364014 40.761521918979774,-74.00459289550781 40.762497077668186,-74.00437831878662 40.76272461263689,-74.00236129760742 40.761814468088524,-74.00180339813232 40.76252958271142,-74.00390625 40.763537231166424,-74.00360584259033 40.76382977140484,-74.00141716003418 40.76308216601392,-74.00326251983643 40.7645448643447,-74.0000867843628 40.763634744722296,-74.00261878967285 40.76509743089209,-74.00214672088623 40.766007530484536,-73.99905681610107 40.76467488041623,-73.99858474731445 40.765519978681375,-74.00180339813232 40.76682010887469,-74.00146007537842 40.767470164433206,-73.99798393249512 40.766007530484536,-74.00060176849365 40.76815271592594,-74.00051593780518 40.76847773798229,-73.9972972869873 40.76730765113972,-73.9967393875122 40.76805520899906,-73.9998722076416 40.76929028616809,-73.99884223937988 40.77091535273251,-73.9963960647583 40.76997281896583,-73.99558067321777 40.771077857203096,-73.99721145629883 40.77254037955371,-73.99635314941406 40.77338537779408))') group by 2 order by 1 desc limit 100;

-- Bronx Co-Op complaints

select count(*), complaint_type from nyc."311" where within(geometry, 'POLYGON((-73.81816864013672 40.872234387421415,-73.81439208984375 40.864121059242294,-73.81791114807129 40.859366186990854,-73.82331848144531 40.856818213962015,-73.82821083068848 40.85996665044076,-73.83421897888184 40.871909873380666,-73.83550643920898 40.87496024256856,-73.83726596832275 40.87791312566155,-73.83825302124023 40.88138502849814,-73.83559226989746 40.883104688628976,-73.83009910583496 40.88534342449058,-73.81975650787354 40.890080210136745,-73.81542205810547 40.89027486530701,-73.81593704223633 40.88411050686329,-73.81799697875977 40.877750882757525,-73.81816864013672 40.872234387421415))') group by 2 order by 1 desc limit 100;

-- Tribeca complaints

select count(*), complaint_type from nyc."311" where within(geometry, 'POLYGON((-74.0018892288208 40.71941393317829,-74.00866985321045 40.711366485955395,-74.01394844055176 40.7137574012351,-74.01128768920898 40.725782242800086,-74.0018892288208 40.71941393317829))') group by 2 order by 1 desc limit 100;

-- Rikers Island complaints

select count(*), complaint_type from nyc."311" where within(geometry, 'POLYGON((-73.89103889465332 40.797554275108396,-73.88777732849121 40.79826900506864,-73.88331413269043 40.79541003905568,-73.8786792755127 40.79443536340943,-73.87507438659668 40.79209608347654,-73.87181282043457 40.79079644789993,-73.87086868286133 40.78787217484408,-73.87275695800781 40.78585760071313,-73.88005256652832 40.785402688419076,-73.88897895812988 40.787157332954294,-73.89018058776855 40.79008163748971,-73.89206886291504 40.79040655226648,-73.89327049255371 40.79411046834751,-73.89103889465332 40.797554275108396))') group by 2
order by 1 desc limit 100;

-- Central Park complaints

select count(*), complaint_type from nyc."311" where within(geometry, 'POLYGON((-73.98197650909424 40.76795770143317,-73.97300720214844 40.764317335111535,-73.94918918609619 40.79700847653521,-73.95824432373047 40.80061456517537,-73.98197650909424 40.76795770143317))') group by 2 order by 1 desc limit 100;

-- Food poisoning
select count(*), incident_address, extract('year' from created_date) from nyc."311" where match(complaint_type, 'Food Poisoning') group by 2,3 having incident_address is not null order by 1 desc limit 100;


-- which borough has the highest vehicle noise complaints?

select count(*), borough  from nyc."311" where match(complaint_type_ft, 'Noise vehicle') using best_fields with (operator='and') group by 2 order by 1 desc limit 100;


-- Stuff happening around Rudi's

select count(*), complaint_type from nyc."311" where distance(geometry, 'POINT(-73.99173974990845 40.75998276420751)') < 100 group by 2 order by 1 desc limit 100;
